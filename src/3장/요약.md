단일 함수 분해: 파싱, 검증, 가격, 할인, 저장을 각각 전담하는 작은 메서드와 정책 클래스로 분리

출력 인자/플래그 제거: boolean vip, List<String> errors를 제거하고 CheckoutRequest DTO로 통합

예외 중심 제어: 오류를 코드 대신 ValidationException, OutOfStockException으로 표현

정책 캡슐화: 가격/할인 계산을 PricingPolicy, DiscountPolicy 전략 패턴으로 분리

부작용 제거: lastOrderId 상태를 없애고 모든 결과를 명시적 반환(Receipt)
